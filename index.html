<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    </head>
    <style>

        .container{
            margin:10%;
            
        }
        #search{
            border: 2px solid black;
            padding: 3%;
        }
        #Nav{
            margin-top: 0%;
        }
        /* .forecast{
            float: right;

        } */
    </style>
<body>
    <nav class="navbar navbar-light bg-dark" id= "Nav" style= "margin:0%;">
        <span class="navbar-brand mb-0 h1 m-auto">Weather Dashboard</span>
      </nav>
      <div class="container">
        <div class="row" >
          <div class="col-sm-3"id= "search">
            <input type="text" id="city" name="city" value=""><br>
            <input id ="button" type="button" value="Submit">
            <input id ="buttonClear" type="button" value="Clear">            
            <br></br>
            <div class= "historyButtons"></div>
          </div>
          <div class="col-sm-9">
            <div class= "container" id= "mainWeather" >Weather Information Will be Displayed Here</div>
            <div class= "forecast"></div>
          </div>
          <!-- <div class="col-sm">
            One of three columns
          </div> -->
        </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- <script src="moment.js"></script> -->
    <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script> -->
    <script>
        $("#buttonClear").click(function(){
            window.location.href = "index.html"
        })

        var cityHistory = [];
        var lat = "";
        var lon = "";
        var currentDate = new Date();
        var nowDay = currentDate.getDate();
        var nowYear = currentDate.getFullYear();
        var nowMonth = currentDate.getMonth()+1;
        var fullDate = nowMonth + "/" + nowDay + "/" + nowYear;
        $("#button").click(function(){
            cityName = $("#city").val();
            $("#city").val("")
            cityHistory.push(cityName);
            localStorage.setItem("history",cityHistory);
            var queryURL = "http://api.openweathermap.org/data/2.5/weather?q="+ cityName +"&appid=7d8a57cfe0185102716711da0a05d909";
            $.ajax({
            url: queryURL,
            method: "GET"
        })
            .then(function(response){
                var results = response.data;
                console.log(response)
                console.log(response.main)
                console.log(response.main.temp);
                console.log(response.main.humidity);
                console.log(response.wind.speed);
                localStorage.setItem("citylat",response.coord.lat);
                localStorage.setItem("citylon",response.coord.lon);

                var citylon = response.coord.lot;
                //*** DISPLAY ON CARD
                $
                var cardClass = $("<div>");
                cardClass.attr("class","card");
                var cardBody = $("<div>");
                cardBody.attr("class", "card-body");
                cardBody.append("<h1>"+response.name+ " " +fullDate + "</h1> ");
                cardBody.append("<p> Temperature: "+ response.main.temp +"</p>");
                cardBody.append("<p> Wind: "+ response.wind.speed +"</p>");
                cardClass.append(cardBody);
                cardClass.css("width","30rem")
                $("#mainWeather").html(cardClass)
                //***DISPLAY ON CARD

            }) 
            lat = localStorage.getItem("citylat");
            lon = localStorage.getItem("citylon");
            console.log(lat,lon)
            
            nextDays();
        })
        
        function nextDays(){
            var queryURL = "https://api.openweathermap.org/data/2.5/onecall?lat="+lat+"&lon="+lon+"&appid=7d8a57cfe0185102716711da0a05d909";
            $.ajax({
                url: queryURL,
                method: "GET"
            })
            .then(function(response){
                for (var i=1; i<6; i++){
                    var colClass = $("<div>");
                    colClass.attr("class", "col-sm-2")
                    var tempMin = response.daily[i].temp.min;
                    var tempMax = response.daily[i].temp.max;
                    var FcardText = $("<div>");
                    FcardText.attr("class","card-body");
                    FcardText.append("<p> High: "+tempMax+"</p>");
                    FcardText.append("<p> Low: "+tempMin+"</p>");
                    var FcardClass = $("<div>");
                    FcardClass.attr("class","card")
                    FcardClass.append(FcardText);
                    colClass.append(FcardClass)
                    $(".forecast").append(colClass)

                    
                }
                console.log(response)
                getHistory();
            })
        }
        function getHistory() {
            $(".historyButtons").html("")
            $(".forecast").html("");
            for (i in cityHistory){
                var buttonSpace = $("<div>")
                var cityButton = $("<BUTTON>");
                cityButton.text(cityHistory[i]);
                buttonSpace.append(cityButton)
                cityName = cityHistory[i]
                // if cityButton
                $(".historyButtons").append(buttonSpace)
            }
        }
                // var cardClass = $("<div>");
                // cardClass.attr("class","card");
                // var cardBody = $("<div>");
                // cardBody.attr("class", "card-body");
                // cardBody.append("<h1>"+response.name+ " " +fullDate + "</h1> ");
                // cardBody.append("<p> Temperature: "+ response.main.temp +"</p>");
                // cardBody.append("<p> Wind: "+ response.wind.speed +"</p>");
                // cardClass.append(cardBody);
                // cardClass.css("width","30rem")
                // $("#mainWeather").html(cardClass)
//         <div class="card" style="width: 18rem;">
//   <div class="card-body">
//     <h5 class="card-title">Card title</h5>
//     <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
//     <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
//     <a href="#" class="card-link">Card link</a>
//     <a href="#" class="card-link">Another link</a>
//   </div>
// </div>
            
    </script>
    
</body>
</html>